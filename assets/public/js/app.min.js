$(document).ready(function(){$("#logout").click(function(a){return a.preventDefault(),$.ajax({type:"GET",url:"/admin",async:!1,username:"username",password:"password",headers:{Authorization:"Basic xxx"}}).fail(function(){window.location="/"}),!1}),$(document).pjax("a[data-pjax]","#content")}),$(document).on("ready pjax:end",function(){function a(){this.style.height="5px",this.style.height=this.scrollHeight+"px"}return $("#content").off(),document.title=document.getElementById("site-title").innerHTML,$("textarea").each(a),$("textarea").keyup(a),$(window).resize(function(){$("textarea").each(a)}),$("main").hasClass("browse")&&$(document).trigger("page:browse"),$(".editor")[0]&&$(document).trigger("page:editor"),!1}),$(document).on("page:browse",function(){var a="#foreground",b="form#delete",c=null;$("#content").on("click",".delete",function(d){return d.preventDefault(),c=new Object,c.url=$(this).data("file"),c.row=$(this).parent().parent(),c.filename=$(c.row).find(".filename").text(),$(b).find("span").text(c.filename),$(b).fadeIn(200),$(a).fadeIn(200),!1}),$("#content").on("submit",b,function(d){if(d.preventDefault(),null==c)return notification({text:"Something is wrong with your form.",type:"error"}),!1;var e=new XMLHttpRequest;return e.open("DELETE",c.url),e.send(),e.onreadystatechange=function(){if(4==e.readyState){var d=JSON.parse(e.responseText),f="success",g=5e3;$(a).fadeOut(200),$(b).fadeOut(200),$(c.row).fadeOut(200),200!=e.status&&(f="error",g=!1),notification({text:d.message,type:f,timeout:g}),c=null}},!1}),$("#content").on("change",'input[type="file"]',function(a){a.preventDefault(),files=a.target.files,$("#loading").fadeIn();var b=new FormData;return $.each(files,function(a,c){b.append(a,c)}),$.ajax({url:window.location.pathname,type:"POST",data:b,cache:!1,dataType:"json",headers:{"X-Upload":"true"},processData:!1,contentType:!1}).done(function(a){notification({text:"File(s) uploaded successfully.",type:"success",timeout:5e3}),$("#loading").fadeOut(),$.pjax({url:window.location.pathname,container:"#content"})}).fail(function(a){$("#loading").fadeOut(),notification({text:"Something went wrong.",type:"error"}),console.log(a)}),!1}),$("#content").on("click","#upload",function(a){return a.preventDefault(),$('.actions input[type="file"]').click(),!1});var d="form#new",e=d+' input[type="text"]';$("#content").on("click",".new",function(b){return b.preventDefault(),$(a).fadeIn(200),$(d).fadeIn(200),!1}),$("#content").on("keypress",e,function(a){return 13==a.keyCode?(a.preventDefault(),$(d).submit(),!1):void 0}),$("#content").on("submit",d,function(a){a.preventDefault();var b=$(e).val(),c=b.split(":"),d="",f="";if(""==b)return notification({text:"You have to write something. If you want to close the box, click the button again.",type:"warning",timeout:5e3}),!1;if(1==c.length)d=b;else{if(2!=c.length)return notification({text:"Hmm... I don't understand you. Try writing something like 'name[:archetype]'.",type:"error"}),!1;d=c[0],f=c[1]}var g={filename:d,archetype:f},h=new XMLHttpRequest;return h.open("POST",window.location.pathname),h.setRequestHeader("Content-Type","application/json;charset=UTF-8"),h.send(JSON.stringify(g)),h.onreadystatechange=function(){if(4==h.readyState){var a=JSON.parse(h.responseText),b="success",c=5e3;200!=h.status&&(b="error",c=!1),notification({text:a.message,type:b,timeout:c}),200==h.status&&$.pjax({url:a.location,container:"#content"})}},!1});var f="form#rename",g=f+' input[type="text"]',h=null;$("#content").on("click",".rename",function(b){return b.preventDefault(),h=$(this).parent().parent().find(".filename").text(),$(a).fadeIn(200),$(f).fadeIn(200),$(f).find("span").text(h),$(f).find('input[type="text"]').val(h),!1}),$("#content").on("keypress",g,function(a){return 13==a.keyCode?(a.preventDefault(),$(f).submit(),!1):void 0}),$("#content").on("submit",f,function(a){a.preventDefault();var b=$(this).find('input[type="text"]').val();if(""===b)return!1;"/"!=b.substring(0,1)&&(b=window.location.pathname.replace("/admin/browse/","")+"/"+b);var c={filename:b},d=new XMLHttpRequest;return d.open("PUT",h),d.setRequestHeader("Content-Type","application/json;charset=UTF-8"),d.send(JSON.stringify(c)),d.onreadystatechange=function(){if(4==d.readyState){var a=JSON.parse(d.responseText),b="success",c=5e3;200!=d.status&&(b="error",c=!1),$.pjax({url:window.location.pathname,container:"#content"}),notification({text:a.message,type:b,timeout:c}),h=null}},!1});var i="button.git",j="form#git",k=j+' input[type="text"]';$("#content").on("click",i,function(b){return b.preventDefault(),$(a).fadeIn(200),$(j).fadeIn(200),!1}),$("#content").on("keypress",k,function(a){return 13==a.keyCode?(a.preventDefault(),$(j).submit(),!1):void 0}),$("#content").on("submit",j,function(b){b.preventDefault();var c=$(this).find('input[type="text"]').val();if(""==c)return notification({text:"You have to write something. If you want to close the box, click outside of it.",type:"warning",timeout:5e3}),!1;var d=new XMLHttpRequest;return d.open("POST","/admin/git"),d.setRequestHeader("Content-Type","application/json;charset=UTF-8"),d.send(JSON.stringify({command:c})),d.onreadystatechange=function(){if(4==d.readyState){var b=JSON.parse(d.responseText);200==d.status?(notification({text:b.message,type:"success",timeout:5e3}),$(j).fadeOut(200),$(a).fadeOut(200),$.pjax({url:window.location.pathname,container:"#content"})):notification({text:b.message,type:"error"})}},!1}),$("#content").on("click",".close",function(b){return b.preventDefault(),$(this).parent().parent().fadeOut(200),$(a).click(),!1}),$("#content").on("click",a,function(c){return c.preventDefault(),$(a).fadeOut(200),$(d).fadeOut(200),$(f).fadeOut(200),$(b).fadeOut(200),$(j).fadeOut(200),!1})}),$(document).on("page:editor",function(){var a=$(".editor"),b=$("#editor-preview"),c=$("#editor-source");if(a.hasClass("complete")&&$("#content").on("keyup","#site-title",function(){$(".frontmatter #title").val($(this).val())}),!a.hasClass("frontmatter-only")){var d=$("#editor-source").data("mode"),e=$('textarea[name="content"]').hide(),f=ace.edit("editor-source");f.getSession().setMode("ace/mode/"+d),f.getSession().setValue(e.val()),f.getSession().on("change",function(){e.val(f.getSession().getValue())}),f.setOptions({wrap:!0,maxLines:1/0,theme:"ace/theme/github",showPrintMargin:!1,fontSize:"1em",minLines:20}),$("#content").on("click","#see-source",function(a){a.preventDefault(),b.hide(),c.fadeIn(),$(this).addClass("active"),$("#see-preview").removeClass("active"),$("#see-preview").data("previewing","false")}),$("#content").on("click","#see-preview",function(a){if(a.preventDefault(),"true"==$(this).data("previewing"))b.hide(),c.fadeIn(),$(this).removeClass("active"),$("#see-source").addClass("active"),$(this).data("previewing","false");else{var d=new showdown.Converter,e=f.getValue(),g=d.makeHtml(e);c.hide(),b.html(g).fadeIn(),$(this).addClass("active"),$("#see-source").removeClass("active"),$(this).data("previewing","true")}return!1})}$("#content").on("keypress","input",function(a){return 13==a.keyCode?(a.preventDefault(),$('input[value="Save"]').focus().click(),!1):void 0});var g=null;$("#content").on("click","form input[type=submit]",function(a){g=this}),$("#content").on("submit","form",function(d){d.preventDefault(),a.hasClass("frontmatter-only")||(b.html("").fadeOut(),$("#see-preview").data("previewing","false"),c.fadeIn());var e=$(g),f={content:$(this).serializeJSON(),contentType:e.data("type"),schedule:e.data("schedule"),regenerate:e.data("regenerate")},h=new XMLHttpRequest;return h.open("POST",window.location),h.setRequestHeader("Content-Type","application/json;charset=UTF-8"),h.send(JSON.stringify(f)),h.onreadystatechange=function(){if(4==h.readyState){var a=JSON.parse(h.responseText),b="success",c=5e3;200==h.status&&(a.message=e.data("message")),200!=h.status&&(b="error",c=!1),notification({text:a.message,type:b,timeout:c})}},!1}),$("#content").on("click",".add",function(a){if(a.preventDefault(),defaultID="lorem-ipsum-sin-dolor-amet",newItem=$("#"+defaultID),newItem.length&&newItem.remove(),block=$(this).parent().parent(),blockType=block.data("type"),blockID=block.attr("id"),"array"==blockType&&(newID=blockID+"[]",input=blockID,input=input.replace(/\[/,"\\["),input=input.replace(/\]/,"\\]"),block.append('<div id="'+newID+"-"+$("#"+input+" > div").length+'" data-type="array-item"><input name="'+newID+':auto" id="'+newID+'"></input><span class="actions"> <button class="delete">&#8722;</button></span></div></div>'),console.log("New array item added.")),block.is("div")&&block.hasClass("frontmatter")&&(block=$(".blocks"),blockType="object"),"object"==blockType){if(block.append('<div class="block" id="'+defaultID+'"></div>'),newItem=$("#"+defaultID),newItem.html('<input id="name-'+defaultID+'" placeholder="Write the field name and press enter..."></input>'),field=$("#name-"+defaultID),!document.cookie.replace(/(?:(?:^|.*;\s*)placeholdertip\s*\=\s*([^;]*).*$)|^.*$/,"$1")){var b=new Date;b.setDate(b.getDate()+365),document.cookie="placeholdertip=true; expires="+b.toUTCString+"; path=/",notification({text:'Write the field name and then press enter. If you want to create an array or an object, end the name with ":array" or ":object".',type:"information"})}$(field).keypress(function(a){return 13==a.which?(a.preventDefault(),value=field.val(),""==value?(newItem.remove(),!1):(elements=value.split(":"),elements.length>2?(notification({text:"Invalid syntax. It must be 'name[:type]'.",type:"error"}),!1):2==elements.length&&"array"!=elements[1]&&"object"!=elements[1]?(notification({text:"Only arrays and objects are allowed.",type:"error"}),!1):(field.remove(),"undefined"==typeof blockID?blockID=elements[0]:blockID=blockID+"["+elements[0]+"]",1==elements.length?(newItem.attr("id","block-"+blockID),newItem.append('<input name="'+blockID+':auto" id="'+blockID+'"></input><br>'),newItem.prepend('<label for="'+blockID+'">'+value+'</label> <span class="actions"><button class="delete">&#8722;</button></span>')):(type="","array"==elements[1]?type="array":type="object",template='<fieldset id="${blockID}" data-type="${type}"> <h3>${elements[0]}</h3> <span class="actions"> <button class="add">&#43;</button> <button class="delete">&#8722;</button> </span> </fieldset>',template=template.replace("${blockID}",blockID),template=template.replace("${elements[0]}",elements[0]),template=template.replace("${type}",type),newItem.after(template),newItem.remove(),console.log('"'+blockID+'" block of type "'+type+'" added.')),!1))):void 0})}return!1}),$("#content").on("click",".delete",function(a){return a.preventDefault(),button=$(this),name=button.parent().parent().attr("for")||button.parent().parent().attr("id")||button.parent().parent().parent().attr("id"),name=name.replace(/\[/,"\\["),name=name.replace(/\]/,"\\]"),console.log(name),$('label[for="'+name+'"]').fadeOut().remove(),$("#"+name).fadeOut().remove(),!1})}),$.noty.themes.admin={name:"admin",helpers:{},modal:{css:{position:"fixed",width:"100%",height:"100%",backgroundColor:"#000",zIndex:1e4,opacity:.6,display:"none",left:0,top:0}}},$.noty.defaults={layout:"topRight",theme:"admin",dismissQueue:!0,animation:{open:"animated bounceInRight",close:"animated fadeOut",easing:"swing",speed:500},timeout:!1,force:!1,modal:!1,maxVisible:5,killer:!1,closeWith:["click"],callback:{onShow:function(){},afterShow:function(){},onClose:function(){},afterClose:function(){},onCloseClick:function(){}},buttons:!1},notification=function(a){var b;switch(a.type){case"success":b='<i class="fa fa-check"></i>';break;case"error":b='<i class="fa fa-times"></i>';break;case"warning":b='<i class="fa fa-exclamation"></i>';break;case"information":b='<i class="fa fa-info"></i>';break;default:b='<i class="fa fa-bell"></i>'}var c={template:'<div class="noty_message"><span class="noty_icon">'+b+'</span><span class="noty_text"></span></div>'};if(a=$.extend({},c,a),noty(a),!document.cookie.replace(/(?:(?:^|.*;\s*)stickynoties\s*\=\s*([^;]*).*$)|^.*$/,"$1")&&!a.timeout){var d=new Date;d.setDate(d.getDate()+365),document.cookie="stickynoties=true; expires="+d.toUTCString+"; path=/",notification({text:"Some notifications are sticky. If it doesn't go away, click to dismiss it.",type:"information"})}};